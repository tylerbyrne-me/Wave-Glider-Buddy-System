{% extends "base.html" %}

{% block title %}Admin Reports - Wave Glider Buddy{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1>Admin Reports</h1>
    <p>Generate summary reports for various system data.</p>

    <div class="card">
        <div class="card-header">
            <h5 class="mb-0">Monthly Approved Timesheet Summary</h5>
        </div>
        <div class="card-body">
            <p>Select a month and year to download a CSV summary of all approved timesheets for pay periods that ended within that month.</p>
            <form id="monthlyTimesheetReportForm">
                <div class="row g-3 align-items-end">
                    <div class="col-md-4">
                        <label for="reportYear" class="form-label">Year</label>
                        <select id="reportYear" class="form-select"></select>
                    </div>
                    <div class="col-md-4">
                        <label for="reportMonth" class="form-label">Month</label>
                        <select id="reportMonth" class="form-select">
                            <option value="1">January</option>
                            <option value="2">February</option>
                            <option value="3">March</option>
                            <option value="4">April</option>
                            <option value="5">May</option>
                            <option value="6">June</option>
                            <option value="7">July</option>
                            <option value="8">August</option>
                            <option value="9">September</option>
                            <option value="10">October</option>
                            <option value="11">November</option>
                            <option value="12">December</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="fas fa-download me-2"></i>Download Report
                        </button>
                    </div>
                </div>
            </form>
            <div id="reportStatus" class="mt-3"></div>
        </div>
    </div>

    <!-- Chart Display Card -->
    <div class="card mt-4">
        <div class="card-header">
            <h5 class="mb-0">Pilot Hours Summary Chart</h5>
        </div>
        <div class="card-body">
            <p>A visual summary of total approved hours per pilot for the selected month. The chart will generate when you download a report.</p>
            <div id="chartContainer" style="display: none; max-height: 400px;">
                <canvas id="pilotHoursChart"></canvas>
            </div>
            <div id="chartSpinner" class="text-center" style="display: none;">
                <div class="spinner-border" role="status">
                    <span class="visually-hidden">Loading chart...</span>
                </div>
            </div>
            <div id="noChartData" class="alert alert-secondary text-center" style="display: none;">
                No approved timesheets found for this month to generate a chart.
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block body_extra_js %}
<script type="module" src="{{ url_for('static', path='js/admin_reports.js') }}"></script>
{% endblock %}