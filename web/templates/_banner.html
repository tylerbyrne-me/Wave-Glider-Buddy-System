<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top" style="height: var(--banner-height);">
  <div class="container-fluid">
    <div class="d-flex flex-column w-100"> {# New wrapper div to stack rows vertically #}
      <!-- Top Row -->
      <div class="navbar-top-row d-flex align-items-center" style="height: var(--banner-top-row-height);"> {# Removed justify-content-between #}
        <div class="d-flex align-items-center" style="padding-left: var(--banner-padding-x);"> {# Left aligned title #}
          <h3 class="navbar-title mb-0">Wave Glider Buddy System</h3>
        </div>
        <div class="d-flex align-items-center me-auto ms-auto"> {# Use auto margins for centering #}
          <span id="utcClockBanner" class="navbar-text"></span> {# Removed me-3 #}
        </div>
        <ul class="navbar-nav" style="padding-right: var(--banner-padding-x);"> {# Right aligned user dropdown #}
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false"> {# Removed text-align:right, as it's handled by flexbox #}
              <span id="usernameDisplayBanner">{{ current_user.username if current_user else 'User' }}</span>
            </a>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
              <li><a class="dropdown-item" href="#">User Settings (TBD)</a></li>
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item" href="#" id="logoutBtnBanner">Logout</a></li>
              <li><hr class="dropdown-divider"></li>
              <li>
                <div class="px-3 py-1">
                  <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" role="switch" id="themeSwitch">
                    <label class="form-check-label small" for="themeSwitch">Dark Mode</label>
                  </div>
                </div>
              </li>
            </ul>
          </li>
        </ul>
      </div>

      <!-- Bottom Row -->
      <div class="navbar-bottom-row" style="height: var(--banner-bottom-row-height);">
        <ul class="navbar-nav d-flex" style="padding-left: var(--banner-padding-x); width:100%;"> {# Removed justify-content-start for individual item control #}
          <li class="nav-item me-3"> {# Added me-3 for spacing #}
            <a class="nav-link" href="#">Home (TBD)</a>
          </li>
          <li class="nav-item dropdown me-3"> {# Added me-3 for spacing #}
            <a class="nav-link dropdown-toggle" href="#" id="missionDashboardDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Mission Dashboard
            </a>
            <ul class="dropdown-menu" aria-labelledby="missionDashboardDropdown" id="missionSelectorDropdownMenu">
              <!-- Mission options populated by JS -->
              <li><a class="dropdown-item" href="/">Loading Missions...</a></li>
            </ul>
          </li>
          <li class="nav-item me-3"> {# Added me-3 for spacing #}
            <a class="nav-link" href="/schedule.html">Schedule</a>
          </li>
          <li class="nav-item me-3"> {# Added me-3 for spacing #}
            <a class="nav-link" href="/view_station_status.html">Station Offloads</a>
          </li>
          <li class="nav-item dropdown me-3" id="picManagementDropdown" style="display: none;"> {# Added me-3 for spacing #}
            <a class="nav-link dropdown-toggle" href="#" id="picManagementDropdownLink" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              PIC Management
            </a>
            <ul class="dropdown-menu" aria-labelledby="picManagementDropdownLink">
              <li><a class="dropdown-item" id="submitNewPicHandoffLink" href="#">Submit New PIC Handoff</a></li>
              <li><a class="dropdown-item" href="/my_pic_handoffs.html">My PIC Handoffs</a></li>
              <li><a class="dropdown-item" href="/view_pic_handoffs.html">Recent PIC Handoffs (24h)</a></li>
            </ul>
          </li>
          <li class="nav-item dropdown me-3" id="adminManagementDropdown" style="display: none;"> {# Added me-3 for spacing #}
            <a class="nav-link dropdown-toggle" href="#" id="adminManagementDropdownLink" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Admin Management
            </a>
            <ul class="dropdown-menu" aria-labelledby="adminManagementDropdownLink">
              <li><a class="dropdown-item" href="/admin/user_management.html">User Management</a></li>
              <li><a class="dropdown-item" href="/view_forms.html">View All Forms</a></li>
            </ul>
          </li>
          <!-- Auto-refresh toggle, only visible on dashboard page -->
          {% if is_current_mission_realtime %}
          <li class="nav-item ms-auto me-3"> {# ms-auto pushes this to the right #}
            <div class="form-check form-switch d-flex align-items-center"> {# Removed float:right #}
              <input class="form-check-input me-2" type="checkbox" role="switch" id="autoRefreshToggleBanner" checked>
              <label class="form-check-label small text-white" for="autoRefreshToggleBanner" title="Enable/disable 5-minute auto-refresh for this real-time mission.">Auto-Refresh <span id="refreshCountdown"></span></label>
            </div>
          </li>
          {% endif %}
        </ul>
      </div>
    </div>
  </div>
</nav>