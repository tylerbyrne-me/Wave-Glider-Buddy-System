{% extends "base.html" %}

{% block title %}User Management - Wave Glider Buddy{% endblock %}

{% block head_extra_css %}
<style>
    .table-responsive {
        max-height: 75vh;
    }
    .modal-body label {
        margin-top: 0.5rem;
    }
    .action-buttons button {
        margin-right: 5px;
    }
    .action-buttons button:last-child {
        margin-right: 0;
    }
    .user-color-indicator {
        display: inline-block;
        box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        transition: transform 0.2s ease;
    }
    .user-color-indicator:hover {
        transform: scale(1.1);
        box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }
</style>
{% endblock %}

{% block content %}
<div style="padding-top: 70px;">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1>User Management</h1>
        <div>
            <button type="button" class="btn btn-primary me-2" id="addNewUserBtn">Add New User</button>
            <a href="#" id="closeUserManagementPageBtn" class="btn btn-outline-secondary">Close Page</a>
        </div>
    </div>
    <div id="userManagementSpinner" class="text-center my-5">
        <div class="spinner-border text-light" role="status">
            <span class="visually-hidden">Loading users...</span>
        </div>
        <p>Loading users...</p>
    </div>

    <div id="userManagementTableContainer" style="display:none;">
        <div class="table-responsive">
            <table class="table table-striped table-hover table-sm">
                <thead>
                    <tr>
                        <th>Username</th>
                        <th>Full Name</th>
                        <th>Email</th>
                        <th>Role</th>
                        <th>Color <small class="text-muted">(for schedule)</small></th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="usersTableBody">
                    <!-- User rows will be inserted here by JavaScript -->
                </tbody>
            </table>
        </div>
        <p id="noUsersMessage" class="text-center text-muted mt-3" style="display:none;">No users found.</p>
    </div>

    <!-- Edit User Modal -->
    <div class="modal fade" id="editUserModal" tabindex="-1" aria-labelledby="editUserModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editUserModalLabel">Edit User</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editUserForm">
                        <input type="hidden" id="editUsername">
                        <div class="mb-3">
                            <label for="editFullName" class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="editFullName">
                        </div>
                        <div class="mb-3">
                            <label for="editEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="editEmail">
                        </div>
                        <div class="mb-3">
                            <label for="editRole" class="form-label">Role</label>
                            <select class="form-select" id="editRole">
                                <option value="pilot">Pilot</option>
                                <option value="admin">Admin</option>
                            </select>
                        </div>
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="editDisabled">
                            <label class="form-check-label" for="editDisabled">
                                Disabled
                            </label>
                        </div>
                        <div id="editUserError" class="alert alert-danger" style="display: none;"></div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveUserChangesBtn">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add New User Modal -->
    <div class="modal fade" id="addNewUserModal" tabindex="-1" aria-labelledby="addNewUserModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addNewUserModalLabel">Add New User</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addNewUserForm">
                        <div class="mb-3">
                            <label for="newUsername" class="form-label">Username *</label>
                            <input type="text" class="form-control" id="newUsername" required>
                        </div>
                        <div class="mb-3">
                            <label for="newFullName" class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="newFullName">
                        </div>
                        <div class="mb-3">
                            <label for="newEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="newEmail">
                        </div>
                        <div class="mb-3">
                            <label for="newRole" class="form-label">Role *</label>
                            <select class="form-select" id="newRole" required>
                                <option value="pilot">Pilot</option>
                                <option value="admin">Admin</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="newUserPassword" class="form-label">Password *</label>
                            <input type="password" class="form-control" id="newUserPassword" required>
                        </div>
                        <div class="mb-3">
                            <label for="newUserConfirmPassword" class="form-label">Confirm Password *</label>
                            <input type="password" class="form-control" id="newUserConfirmPassword" required>
                        </div>
                        <div id="addNewUserError" class="alert alert-danger" style="display: none;"></div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveNewUserBtn">Create User</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="changePasswordModalLabel">Change Password for <span id="passwordChangeUsername"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="changePasswordForm">
                        <input type="hidden" id="changePasswordForUsername">
                        <div class="mb-3">
                            <label for="newPassword" class="form-label">New Password</label>
                            <input type="password" class="form-control" id="newPassword" required>
                        </div>
                        <div class="mb-3">
                            <label for="confirmNewPassword" class="form-label">Confirm New Password</label>
                            <input type="password" class="form-control" id="confirmNewPassword" required>
                        </div>
                        <div id="changePasswordError" class="alert alert-danger" style="display: none;"></div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveNewPasswordBtn">Set Password</button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block body_extra_js %}
<script type="module" src="/static/js/admin_user_management.js"></script>
{% endblock %}
