<!DOCTYPE html>
<html data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}Wave Glider Buddy System{% endblock %}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter+Tight:wght@400;500;600;700&family=Raleway:wght@400;500;600;700&family=Roboto+Mono:wght@400;500&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <link rel="stylesheet" href="/static/css/themes.css">
    <link rel="stylesheet" href="/static/css/custom.css">
    <style>
        /* Custom CSS variables for banner */
        :root {
            --banner-height: 110px; /* Total height of the two-row banner, increased for proper spacing */
            --banner-top-row-height: 50px;
            --banner-bottom-row-height: 50px;
            --banner-padding-x: 1.5rem; /* Consistent padding for left/right */
        }
        html, body { height: 100%; }
        body { /* Increased padding-top to accommodate taller banner and provide spacing */
            padding-top: var(--banner-height);
            display: flex;
            flex-direction: column;
        }
        /* Ensure the main content grows to push footer to bottom when content is short */
        .main-content-wrapper { flex: 1 0 auto; }
        footer { flex-shrink: 0; }
    </style>
    {% block head_extra_css %}{% endblock %}
</head>
<body class="{% block body_class %}container-fluid mt-4{% endblock %}"
      data-username="{{ current_user.username if current_user else '' }}"
      data-user-role="{{ current_user.role.value if current_user else '' }}"
      {% block body_data_attributes %}{% endblock %}>

    {% block navbar %}
        {% include "_banner.html" %}
    {% endblock %}

    <div class="{% block content_container_class %}container-fluid main-content-wrapper{% endblock %}" style="padding-top: {% block content_padding_top %}0px{% endblock %};">
        {% block content %}{% endblock %}
    </div>

    {% block footer %}
    <footer class="mt-5 mb-3 text-center text-muted small">
        Wave Glider Buddy System
        {% if request.path == "/" %}
        <br>
        <small class="text-muted">
          Weather forecast data generated using ICON Wave forecast from the German Weather Service DWD.
          <a href="https://open-meteo.com/" target="_blank">Open-Meteo.com</a>.
          Development assisted by Google's Gemini models and Anysphere's Cursor.
        </small>
        {% endif %}
    </footer>
    {% endblock %}

    <!-- Toast Container for showToast messages -->
    <div id="toast-container" class="toast-container position-fixed top-0 end-0 p-3">
        <!-- Toasts will be appended here -->
    </div>

    <!-- Report Generation Modal -->
    <div class="modal fade" id="reportModal" tabindex="-1" aria-labelledby="reportModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="reportModalLabel">Generate Report for Mission</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="reportForm">
                        <input type="hidden" id="reportMissionId">
                        <div class="mb-3">
                            <label for="startDate" class="form-label">Start Date (Optional)</label>
                            <input type="date" class="form-control" id="startDate">
                        </div>
                        <div class="mb-3">
                            <label for="endDate" class="form-label">End Date (Optional)</label>
                            <input type="date" class="form-control" id="endDate">
                        </div>
                        <div class="mb-3">
                            <h6>Plots to Include:</h6>
                            <div id="plot-selection-group">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="telemetry" id="includeTelemetry" checked>
                                    <label class="form-check-label" for="includeTelemetry">Telemetry Track</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="power" id="includePower" checked>
                                    <label class="form-check-label" for="includePower">Power Summary</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="ctd" id="includeCtd" checked>
                                    <label class="form-check-label" for="includeCtd">CTD Summary</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="weather" id="includeWeather" checked>
                                    <label class="form-check-label" for="includeWeather">Weather Summary</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="waves" id="includeWave" checked>
                                    <label class="form-check-label" for="includeWave">Wave Summary</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="errors" id="includeErrors" checked>
                                    <label class="form-check-label" for="includeErrors">Error Report</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" role="switch" id="saveToOverview" checked>
                            <label class="form-check-label" for="saveToOverview">Save as official mission report</label>
                            <small class="form-text text-muted d-block">Uncheck to generate a one-off report without updating the mission's main report link.</small>
                        </div>
                        <div class="mb-3" id="customFilenameGroup" style="display: none;">
                            <label for="customFilename" class="form-label">Custom Report Name (Optional)</label>
                            <input type="text" class="form-control" id="customFilename" placeholder="e.g., incident_report_2024-07-26">
                            <small class="form-text text-muted d-block">A name for your one-off report. The date and .pdf extension will be added automatically.</small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="generateReportBtn">Generate Report</button>
                </div>
            </div>
        </div>
    </div>

    <script>window.APP_FEATURES = {{ feature_flags_json|safe }};</script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module" src="/static/js/auth.js"></script>
    {% block scripts %}{% endblock %} {# For page-specific script files like schedule.js #}
    {% block body_extra_js %}{% endblock %}
</body>
</html>