<!DOCTYPE html>
<html data-bs-theme="dark">
<head>
  <title>Wave Glider Status - {{ mission }}</title>
  <!-- Include Chart.js and its date adapter -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container py-4" data-mission-id="{{ mission }}">
  <h1>Current Mission Status: {{ mission }}</h1>
  <!-- General Error Display Area -->
  <div id="generalErrorDisplay" class="alert alert-danger" style="display: none;" role="alert">
    An error occurred. Please check console for details or try again later.
  </div>

  <h2>Power</h2>
  <ul>
    <li>Battery (Wh): {{ power.BatteryWattHours if power.BatteryWattHours is not none else "N/A" }}</li>
    <li>Solar Input (W): {{ power.SolarInputWatts if power.SolarInputWatts is not none else "N/A" }}</li>
    <li>Power Draw (W): {{ power.PowerDrawWatts if power.PowerDrawWatts is not none else "N/A" }}</li>
    <li>Net Power (W): {{ power.NetPowerWatts if power.NetPowerWatts is not none else "N/A" }}</li>
    <li>Timestamp: {{ power.Timestamp or "N/A" }}</li>
  </ul>
  <!-- Chart container for Power Trends -->
  <div class="mt-3 mb-4" style="position: relative; height: 350px; width: 100%">
    <h4>Power Trends (Last 72 hours)</h4>
    <canvas id="powerChart"></canvas>
  </div>

  <h2>CTD</h2>
  <ul>
    <li>Water Temperature (°C): {{ ctd.WaterTemperature if ctd.WaterTemperature is not none else "N/A" }}</li>
    <li>Salinity (PSU): {{ ctd.Salinity if ctd.Salinity is not none else "N/A" }}</li>
    <li>Conductivity (S/m): {{ ctd.Conductivity if ctd.Conductivity is not none else "N/A" }}</li>
    <li>Dissolved Oxygen (Hz): {{ ctd.DissolvedOxygen if ctd.DissolvedOxygen is not none else "N/A" }}</li>
    <li>Pressure (dbar): {{ ctd.Pressure if ctd.Pressure is not none else "N/A" }}</li>
    <li>Timestamp: {{ ctd.Timestamp or "N/A" }}</li>
  </ul>
  <!-- Chart container for CTD Trends -->
  <div class="mt-3 mb-4" style="position: relative; height: 350px; width: 100%;">
    <h4>CTD Trends (Last 72 hours)</h4>
    <canvas id="ctdChart"></canvas>
  </div>

  <h2>Weather</h2>
  <ul>
    <li>Air Temperature (°C): {{ weather.AirTemperature if weather.AirTemperature is not none else "N/A" }}</li>
    <li>Wind Speed (kt): {{ weather.WindSpeed if weather.WindSpeed is not none else "N/A" }}</li>
    <li>Wind Gust (kt): {{ weather.WindGust if weather.WindGust is not none else "N/A" }}</li>
    <li>Wind Direction (°): {{ weather.WindDirection if weather.WindDirection is not none else "N/A" }}</li>
    <li>Timestamp: {{ weather.Timestamp or "N/A" }}</li>
  </ul>
<!-- Chart container for Weather Sensor Trends -->
  <div class="mt-3 mb-4" style="position: relative; height: 350px; width: 100%;">
    <h4>Weather Sensor Trends (Last 72 hours)</h4>
    <canvas id="weatherSensorChart"></canvas>
  </div>

  <!-- Weather Forecast Section -->
  <div class="mt-4">
    <h2>Weather Forecast</h2>
    <div id="forecastDisplay">
      <!-- Initial 12 hours will be rendered here by JS -->
      <div id="forecastInitial" class="table-responsive">
          <p class="text-muted">Loading initial forecast...</p>
      </div>
      <!-- Button to toggle more forecast data -->
      <button class="btn btn-outline-secondary btn-sm mt-2" type="button" data-bs-toggle="collapse" data-bs-target="#forecastExtended" aria-expanded="false" aria-controls="forecastExtended" id="toggleForecastBtn" style="display: none;">
        Show More
      </button>
      <!-- Collapsible container for extended forecast -->
      <div class="collapse mt-2" id="forecastExtended">
        <div id="forecastExtendedContent" class="table-responsive">
          <!-- Extended forecast will be rendered here by JS -->
        </div>
      </div>
    </div>
  </div>

  <h2>Wave</h2>
  <ul>
    <li>Significant Wave Height (m): {{ waves.SignificantWaveHeight if waves.SignificantWaveHeight is not none else "N/A" }}</li>
    <li>Wave Period (s): {{ waves.WavePeriod if waves.WavePeriod is not none else "N/A" }}</li>
    <li>Mean Wave Direction (°): {{ waves.MeanWaveDirection if waves.MeanWaveDirection is not none else "N/A" }}</li>
    <li>Timestamp: {{ waves.Timestamp or "N/A" }}</li>
  </ul>
<!-- Chart container for Wave Trends -->
  <div class="mt-3 mb-4" style="position: relative; height: 350px; width: 100%;">
    <h4>Wave Trends (Last 72 hours)</h4>
    <canvas id="waveChart"></canvas>
  </div>
  <h2>AIS</h2>
  <ul>
    {% for v in ais %}
      <li>{{ v.ShipName or "Unknown Ship" }} (MMSI: {{ v.MMSI or "N/A" }}) — Last Seen: {{ v.LastSeenTimestamp or "N/A" }}</li>
    {% endfor %}
  </ul>

  <h2>Errors</h2>
  <ul>
    {% for err in errors %}
      <li>{{ err.Timestamp or "N/A" }} — {{ err.VehicleName or "N/A" }} — {{ err.ErrorMessage[:60] if err.ErrorMessage else "N/A" }}... (SelfCorrected: {{ err.SelfCorrected }})</li>
    {% endfor %}
  </ul>

  <!-- Link to external JavaScript File -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/static/js/dashboard.js"></script>

</body>
</html>
