{% extends "base.html" %}

{% block body_class %}{% endblock %} {# Remove container-fluid and mt-4 from body for this page #}

{% block title %}Daily Schedule - Wave Glider Buddy{% endblock %}

{% block head_extra_css %}
    {# FullCalendar CSS served locally #}
    <link href="{{ url_for('static', path='fullcalendar/main.min.css') }}" rel="stylesheet" />
    <style>
        /* Custom styles for FullCalendar */
        #calendar {
            max-width: 100%;
            margin: 0 auto;
        }
    </style>
{% endblock %}
{% block content_container_class %}{% endblock %} {# Override base.html's container-fluid #}

{% block content_padding_top %}0px{% endblock %} {# Override if the default body padding is enough due to fixed-top nav #}

{% block content %}
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h1>Daily Shift Schedule</h1>
            {# <a href="#" id="closeSchedulePageBtn" class="btn btn-outline-secondary" title="Close this tab/window">Close Page</a> #}
        </div>
        <p class="text-muted">All times are displayed in your local timezone.</p>
        
        <!-- Schedule Controls -->
        <div class="d-flex justify-content-between align-items-center mb-3">
            <div class="btn-group" role="group" aria-label="Schedule Navigation">
                <button type="button" class="btn btn-outline-secondary btn-sm" id="prevBtn">Previous</button>
                <button type="button" class="btn btn-outline-secondary btn-sm" id="todayBtn">Today</button>
                <button type="button" class="btn btn-outline-secondary btn-sm" id="nextBtn">Next</button>
            </div>
            <div class="d-flex align-items-center">
                 <span class="me-2 text-muted small" id="dateRangeDisplay"></span>
                 <span class="ms-2 fst-italic">View: Time Slots (Weekly)</span>
            </div>
        </div>

        <!-- Download Controls -->
        <div class="d-flex justify-content-start align-items-center mb-3 p-2 border rounded bg-light">
            <span class="me-2 small fw-bold">Download Schedule:</span>
            <div class="me-2">
                <label for="downloadStartDate" class="form-label form-label-sm visually-hidden">Start Date</label>
                <input type="date" class="form-control form-control-sm" id="downloadStartDate" style="width: auto;" title="Select start date for download">
            </div>
            <span class="me-2 small">to</span>
            <div class="me-2">
                <label for="downloadEndDate" class="form-label form-label-sm visually-hidden">End Date</label>
                <input type="date" class="form-control form-control-sm" id="downloadEndDate" style="width: auto;" title="Select end date for download">
            </div>
            <div class="me-2">
                <label for="downloadFormat" class="form-label form-label-sm visually-hidden">Format</label>
                <select class="form-select form-select-sm" id="downloadFormat" style="width: auto;" title="Select download format">
                    <option value="ics" selected>ICS (Calendar)</option>
                    <option value="csv">CSV (Spreadsheet)</option>
                </select>
            </div>
            <div class="me-2">
                <label for="downloadUserScope" class="form-label form-label-sm visually-hidden">User Scope</label>
                <select class="form-select form-select-sm" id="downloadUserScope" style="width: auto;" title="Select user scope for download">
                    <option value="all_users" selected>All Users</option>
                    <option value="my_shifts">My Shifts Only</option>
                </select>
            </div>
            <button type="button" class="btn btn-primary btn-sm" id="downloadScheduleBtn">Download</button>
        </div>

        <!-- Container for FullCalendar -->
        <div id='calendar'></div>

{% endblock %}

{% block scripts %}
    {# Ensure jQuery is loaded if DayPilot or your custom scripts need it #}
    {# <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> #}

    {# auth.js should be loaded if not already in base.html or if schedule.js depends on it directly #}
    {# Assuming auth.js is loaded in base.html or similar #}
    <script>
        async function initializeCurrentUserForScheduler() {
            if (typeof getUserProfile === 'function') {
                window.currentUser = await getUserProfile(); // from auth.js
                if (!window.currentUser) {
                    console.warn("Schedule page: Current user not available. Interactive features might be limited.");
                }
            } else {
                console.error("Schedule page: getUserProfile function not found. Ensure auth.js is loaded.");
            }
        }
    </script>

    {# FullCalendar JS served locally #}
    <script src="{{ url_for('static', path='fullcalendar/main.min.js') }}"></script>

    {# Link to your custom schedule.js if you move the script out #}
    <script src="{{ url_for('static', path='js/schedule.js') }}"></script>
{% endblock %}